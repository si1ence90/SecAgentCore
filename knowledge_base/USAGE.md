# SecAgent-Core 知识库使用指南

本指南详细说明了如何使用和扩展 SecAgent-Core 的场景化知识库。

## 1. 知识库的作用

SecAgent-Core 的知识库旨在为 Agent 提供预定义的、场景化的任务规划指导。当用户输入一个任务时，Agent 会首先尝试在知识库中寻找匹配的场景。如果找到，Agent 将严格遵循知识库中定义的"任务规划步骤"来执行任务，从而提高任务执行的准确性和效率。如果未找到匹配的知识，Agent 将自主进行任务规划。

## 2. 知识库文件位置

知识库文件存储在 `knowledge_base/` 目录下。每个 `.txt` 文件代表一个独立的知识场景。

## 3. 知识库文件格式

每个知识库文件必须遵循以下 Markdown 风格的纯文本格式：

```
场景：[场景名称]

适用任务：
- [任务描述关键词或短语 1]
- [任务描述关键词或短语 2]
...

任务规划步骤：
1. [详细步骤 1]
   - [子步骤/参数说明]
2. [详细步骤 2]
   - [子步骤/参数说明]
...

工具使用指南：
- [工具名称 A]: [简要说明和使用建议]
- [工具名称 B]: [简要说明和使用建议]
...

注意事项：
- [安全提示 1]
- [性能考虑 2]
...
```

### 字段说明：

- **`场景：`**: 必填。简要概括该知识库条目所涵盖的领域或问题。
- **`适用任务：`**: 必填。列出用户可能输入的与此场景相关的任务描述。Agent 会使用这些关键词进行模糊匹配。请尽量包含多种表达方式。
- **`任务规划步骤：`**: 必填。这是 Agent 核心的执行指导。请以清晰的编号列表形式提供详细的、可执行的步骤。每个步骤可以包含子弹点来提供更具体的说明或工具参数建议。**Agent 会严格按照此处的步骤进行规划。**
- **`工具使用指南：`**: 可选。提供该场景下可能用到的工具的简要说明、最佳实践或特定参数建议。
- **`注意事项：`**: 可选。提供与该场景相关的安全、性能、合规性等方面的提示。

## 4. 知识库的匹配逻辑

Agent 使用以下逻辑来匹配知识库：
1. **关键词匹配**: 提取用户任务描述中的关键词，与知识库文件中"适用任务"和"场景"部分的关键词进行匹配。
2. **场景匹配**: 检查用户任务描述是否与知识库文件中的"适用任务"描述高度相关。
3. **工具名称匹配**: 如果用户任务中提到了特定的工具（如"扫描"、"ping"、"文件分析"），会增加与包含这些工具的知识库的相关性。

系统会计算一个综合相关性分数。只有当分数高于预设阈值（目前为 0.3）时，该知识库内容才会被采纳。

## 5. 如何扩展知识库

要为 SecAgent-Core 添加新的场景化知识，请遵循以下步骤：

1. **创建新文件**: 在 `knowledge_base/` 目录下创建一个新的 `.txt` 文件。文件名应具有描述性，例如 `vulnerability_assessment.txt`。
2. **编写内容**: 按照上述"知识库文件格式"编写内容。
   - **关键是"适用任务"和"任务规划步骤"**。确保"适用任务"能覆盖用户可能提出的各种表述，而"任务规划步骤"则要足够详细和准确，以便 Agent 能够直接执行。
3. **保存文件**: 保存文件后，Agent 在下次启动或创建新会话时会自动加载新的知识。

### 示例：添加一个"漏洞扫描"知识库

假设你想添加一个关于漏洞扫描的知识库：

**`knowledge_base/vulnerability_scan.txt`**
```
场景：漏洞扫描任务

适用任务：
- 扫描系统漏洞
- 检查安全漏洞
- 漏洞评估
- 发现主机漏洞

任务规划步骤：
1. 首先使用 network_ping 工具检查目标主机是否存活。
   - 参数：target_ip（目标IP），port（默认80），timeout（默认3.0秒）
   - 如果主机不存活，报告无法进行漏洞扫描。
2. 如果主机存活，使用 port_scan 工具扫描开放端口，识别运行的服务。
   - 参数：target_ip（目标IP），ports（建议使用"common"或"top1000"）
3. 根据开放端口和服务信息，识别潜在的漏洞利用点。
4. （模拟）使用 vulnerability_scanner 工具对目标进行漏洞扫描。
   - 参数：target_ip（目标IP），services（开放服务列表）
5. 分析漏洞扫描结果，生成详细的漏洞报告。

工具使用指南：
- network_ping: 检查主机可达性。
- port_scan: 发现开放端口和服务。
- vulnerability_scanner: （模拟）执行漏洞扫描。

注意事项：
- 漏洞扫描可能对目标系统造成压力，请务必获得授权。
- 扫描结果需要人工复核，避免误报。
```

通过这种方式，你可以不断丰富 SecAgent-Core 的知识库，使其能够处理更多复杂的安全场景。



